# Example tools for JWT Demonstrations

This directory contains an example tools for the command-line. They can be used for creating JWT, or for verifying JWT.
The tools are implemented in nodejs, and require node to be installed on the workstation, in order to run them.

## To use: Pre-requisites

Before using any of the tools here, you need to install the pre-requisites.

You need node version 6.0 or greater. And you need npm.
To get those, follow the instructions for your platform.
For MacOS, you might look into `brew install node` and `brew install npm`.

## Installing the dependencies.

Make sure you have the dependency modules. These are the node modules the scripts here, depend upon.

1. `npm install`



## Uploading the key into the KVM

Do this to upload the private or public key into the KVM, so that it can be used by Apigee Edge.

Example loading the private key into an _encrypted_ map called "secrets":
```
node ./loadPemIntoKvm.js -v -o $ORG -e $ENV -E -m secrets -N key1 -F keys/private-pkcs8.pem
```

Example loading the public key into a map called "non-secrets":
```
node ./loadPemIntoKvm.js -v -o $ORG -e $ENV -m non-secrets -N key1 -F keys/public.pem
```

You need to do this prior to using some of the flows in this demonstration.

If you are using OPDK, then you may need to use the -T option on that command line:
```
node ./loadPemIntoKvm.js -v -o $ORG -e $ENV -E -m secrets -N key1 -F keys/private-pkcs8.pem -T
node ./loadPemIntoKvm.js -v -o $ORG -e $ENV -m non-secrets -N key1 -F keys/public.pem -T
```

This tells the script to not use the token endpoint when authenticating to the management server. 



## Creating a token

Do this to create a token that you would like to send to Apigee Edge for verification.

```
node ./create-token.js -A RS256 -s subject -i issuer -a audience
```


## Verifying a token

Do this to verify a token generated by the Apigee Edge proxy.

```
node ./verify-token.js -t token -A RS256
```

### Example

```
$ node ../tools/verify-token.js -t eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJBYmJhRGFiYmEiLCJhdWQiOiJBMjk4MjkyOTIiLCJpc3MiOiJ1cm46Ly9hcGlnZWUtZWRnZS1KV1QtcG9saWN5LWRlbW9uc3RyYXRpb24iLCJleHAiOjE1MTAwMjg3MTEsImlhdCI6MTUxMDAyNTExMSwianRpIjoiY2M2NzAzZmItN2M4Yy00YmNhLWFmNTMtNjdmYzcxOGUxNTdkIn0.bnSLyzdQqJn5fHbjFyd4iNPX1q5TIZ5MwmeM7PHzVrwW-yShbx5IG81Lx0j6Pn_6qz4bSqLUJPuzEPNikKVeYV0zlUA3TO5_z412rzo0JkYmQ48l5SCgrPzDXLg6JsUv6FBfupGPnyrtMJT0DhnQXO4m_tkwG2lR_zJGMkI7G-rIOGEHD-RGNQ6Fzoat8V-xJiVQG07vp691UQOyDkq737mWDg_b4Sm_8ZdihR1aI0TfSWFvyi-66IOc00-FmZzOgEyhZBTTIQz4V4WEeaX2_YdnOCO_KvBgZUFNYcp94TcJW1PkBwJcWiAolJexd6PtnTVOnRhoDgmjedhAMrVU_w -A RS256 -s AbbaDabba -C jti:cc6703fb-7c8c-4bca-af53-67fc718e157d -C iss:urn://apigee-edge-JWT-policy-demonstration -a A29829292
Example JWT verifier tool, version: 20171106-1714
Node.js v7.7.1

decoded:
{
  "sub": "AbbaDabba",
  "aud": "A29829292",
  "iss": "urn://apigee-edge-JWT-policy-demonstration",
  "exp": 1510028711,
  "iat": 1510025111,
  "jti": "cc6703fb-7c8c-4bca-af53-67fc718e157d"
}

```




## License

This material is copyright 2017-2018 Google LLC.
and is licensed under the [Apache 2.0 License](LICENSE).
