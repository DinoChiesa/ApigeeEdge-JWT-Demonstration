# Code supporting the JWT Demonstrations

This repository contains code and configuration supporting the JWT demonstrations for
Apigee Edge. JWT is defined in [IETF RFC 7519](https://tools.ietf.org/html/rfc7519). It
is a compact, URL-safe format for representing *claims* to be transferred between
cooperating parties.

## Some Background

"A claim" is nothing more than an asserted statement. For example, "the sky is clear" is
a claim. A JWT wraps up a set of one or more claims, with a digital signature.

The system or participant that creates the JWT is called "the issuer" (iss). JWT _can
be_ issued with the intention that they are decoded and read by a particular system,
known as "the audience" (aud).  The JWT specification also provides a way to designate
the valid times for a token - the issued-at time (iat), the not-before time (nbf), and
the expiry time (exp). The times are all expressed in seconds-since-epoch.

Typically, JWT are issued about a person or system, known as "the subject"
(sub). Accordingly, claims are most often about systems or people, rather than the
weather. For example, a typical claim as stated in English might be "the userid is
012345".

All the "standard claims" such as sub, aud, exp, as well as custom claims like "userid"
are optional. Each system that generates JWT can stipulatye which claims to include;
each system that verifies JWT can include logic to require specific claims.

## The Construction of a JWT

Claims are first represented as a JSON hash. For example:

```json
{
    "sub": "Subject",
    "iss": "Issuer",
    "aud": "Audience",
    "iat": 1510020300,
    "exp": 1510023900,
    "nbf": 1510020300,
    "customClaim1": "value1"
}
```

Then, the JWT spec says that hash should be serialized in compact form, then base64-encoded. This becomes the JWT payload.
The JWT "header" is a hash, which typically indicates some basic information such as the algorith used for signing.

```json
{
    "alg": "RS256",
    "typ": "JWT"
}
```

This, too, is serialized into a compact JSON form, then base64-encoded.

The dot-concatenation of the header and the payload is then signed, and the signature is then base64-encoded. These two parts - the signing base (which itself has two parts) and the actual signature are then concatenated to form a JWT.

This is what a JWT looks like:

```
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYmYiOjE1MTAwMjAzMDAsImlhdCI6MTUxMDAyMDMwMCwic3ViIjoiU3ViamVjdCIsImlzcyI6Iklzc3VlciIsImF1ZCI6IkF1ZGllbmNlIiwiZXhwIjoxNTEwMDIzOTAwLCJjdXN0b21DbGFpbTEiOiJ2YWx1ZTEifQ.akW3MHTRAnWIPdrD14XYcQKFxDqQ7ztqqS1iLUZfQcQJusi805JhlhBmYZ7axQn2DFBvRsk-i_aCwBDiCzOHGIxufyreMUi7dlkVX6aby8shOIG1jwozes9xGR0pe7ekMD7a39FHKntIXfZEZXE0fxFTIjeG0F7Ui8gL8v8pMIX_SRmK6uEPv0gUStQI-x1nJQM7EtOPs4ZnnlA1hA7HAMEZjkv64yZqbEKXC3d_BFEV3-XhlQR8YG6kJyKoPsgxWMN1JeEUn7fn0YM4V0B8bTepVPUYSViqzz6C5vPvDrk0-PiqGGIry9XrxTXTgNvToL8cOFp2c4ZHyONZqsIk8Q
```

## Usefulness of JWT

JWT are useful for capturing claims about a person or system, and transmitting them in a
standard way, such that a cooperating system can verify those claims.  Verification
consists of verifying the digital signature, then evaluating the claims within the
payload and header.

A common example would be an identity provider - that is, a system that can authenticate
users.  When a user provides the correct authentication, the identity provider may issue
a JWT, which includes statements about the user. This JWT can then be verified by any
other system. Let's call the system that examines and verifies a JWT, a "relying party".
If the relying party trusts the identity provider, then the RP can rely on the claims
about the user, contained within the JWT.


## JWT within Apigee Edge

People configuring smart API proxies in Apigee Edge may want those proxies to verify or
generate JWT.  In late 2017, Apigee added JWT policies into the Apigee Edge product to
enable these scenarios. Specifically, there are now policies in Apigee Edge that you can
use to generate or verify JWT using either Hmac or RSA signatures, in 256, 384, or
512-bit strength.  (HS256, HS384, HS512, RS256, RS384, RS512).

It is possible to use Apigee Edge policies to:
- verify JWT that are generated by Apigee Edge, or by external third parties (Azure AD, Google Sign-in, Salesforce.com, Ping, etc.)
- generate tokens that can be verified by Apigee Edge, or by third parties


## Contents of this Repo

* Two [API Proxy bundles](./proxy-bundles)
  - [jwt-verify](./proxy-bundles/verify)
  - [jwt-generate](./proxy-bundles/generate)
* Various [helper tools](./tools)


## License

This material is copyright 2017 Google Inc.
and is licensed under the [Apache 2.0 License](LICENSE).


