# JWT Verification - tokens generated by tools

This API proxy validates a JWT that was created and signed by [the associated tools](../../tools/create-token.js).

This proxy will work on the Apigee Edge public cloud release.

## Deploying

Several notes:

* use a tool like [apigeetool](https://github.com/apigee/apigeetool-node) or [pushapi](https://github.com/carloseberhardt/apiploy) or
[importAndDeploy.js](https://github.com/DinoChiesa/apigee-edge-js/blob/master/examples/importAndDeploy.js)
to deploy the proxy.

* the tool used to create a token requires nodejs.  You should [install node](https://nodejs.org/en/download/) before trying to run the examples. On OSX you may want to `brew install node`.

## Invoking

### To create a token using the RS256 algorithm

```
node <repo-path>/tools/create-token.js  -A RS256  -s Dino -i Myself -a urn://Apigee  -C claim1:value1
```

You will see the JWT emitted in output. It will look like this:

```
Example JWT creator tool, version: 20171106-1714
Node.js v7.7.1

JWT:
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYmYiOjE1MTAwOTUyMzUsImlhdCI6MTUxMDA5NTIzNSwic3ViIjoiUmluZ28uU3RhcnIiLCJpc3MiOiJzZWxmaXNzdWVkIiwiYXVkIjoidXJuOi8vQXBpZ2VlIiwiZXhwIjoxNTEwMDk4ODM1LCJjbGFpbTEiOiJ2YWx1ZTEifQ.bAK4PSIiyiJgiafLPf_lTi0u9Sfx0BUdbIiczCJiyScDvok_C78xy4HK1VONBWykGtB-DFFINIL93V2GfcrNllJW7gxegehu3ZH9u-AZ4g9zlf3j0KE6NiUFwvE2dooFF_xEfrXxx_b5ZNNMm1ep2wRXuPSIDcYHriFYlRwSy42QbsIQfyakYGc_Xld4aF4peFRuzKumxSOfpERPoC1YPvCwnSPqrtkyVOgTGjC7KC2PK6ygJWYHi1dwTutjjsKmfSANAp5u4l7b3o3g4tPEcHb4OQ8yhttKoVn4fbWW-jGh9pywXBbgKf4GAJzQgPR1GpZAtqj-bnYtcNWMsyK9JA

decoded:
{
  "header": {
    "alg": "RS256",
    "typ": "JWT"
  },
  "payload": {
    "nbf": 1510095235,
    "iat": 1510095235,
    "sub": "Ringo.Starr",
    "iss": "selfissued",
    "aud": "urn://Apigee",
    "exp": 1510098835,
    "claim1": "value1"
  }
}
```

This token is signed with RS256, using [a private key included in this repo](../../../tools/keys/private-pkcs8.pem). _This private key is included for demonstration purposes only_!

To verify the token, use this curl command:

```
  jwt='eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJuY....pZAtqj-bnYtcNWMsyK9JA'
  curl -i -X GET https://myorg-test.apigee.net/jwt-verify/t1 -H "Authorization: Bearer $jwt"
```

The result will confirm that the JWT is valid.

```
HTTP/1.1 200 OK
Date: Tue, 07 Nov 2017 22:58:00 GMT
Content-Length: 312
Connection: keep-alive

{
  "status" : "ok",
  "algorithm" : "RS256",
  "claim_names" : "[sub, aud, nbf, iss, claim1, exp, iat]",
  "subject" : "Ringo.Starr",
  "issuer" : "selfissued",
  "audience" : "[urn://Apigee]",
  "expiry" : "2017-11-07T23:53:55.000+0000",
  "out.now" : "2017-11-07T22:58:00+0000",
  "seconds_remaining" : 3354
}

```

This validation uses [the public key](../../../tools/keys/public.pem) that corresponds to the private key referenced above, to verify the signature.

If you would like to use your own key pair, then you can generate one. [Follow the
instructions here](../../../tools/keys/). If you generate a new keypair, you will need
to replace the public key used in the VerifyJWT policies, in order for verification to
succeed.



### To create a token using the HS256 algorithm

```
node <repo-path>/tools/create-token.js  -A HS256  -s Dino -i Myself -a urn://Apigee  -k Secret1234 -C claim1:value1
```


This token is signed with HS256, using the secret passed on the command line.

To verify the token, use this curl command:

```
  jwt='eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJuY....pZAtqj-bnYtcNWMsyK9JA'
  curl -i -X GET https://myorg-test.apigee.net/jwt-verify/t2 -H "Authorization: Bearer $jwt"
```

You once again should see success.
